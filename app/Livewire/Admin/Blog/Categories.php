<?php namespace App\Livewire\Admin\Blog; use App\Models\Category;
use Livewire\Component;
use Illuminate\Support\Str; class Categories extends Component
{ public $categories; public $editingCategory = null; public $name, $slug, $description; #[\Livewire\Attributes\Layout('layouts.admin', ['title' => 'Blog Categories'])] public function render() { $this->categories = Category::withCount('posts')->orderBy('name')->get(); return view('livewire.admin.blog.categories'); } public function updatedName() { if ($this->editingCategory === 'new' || empty($this->slug)) { $this->slug = Str::slug($this->name); } } public function createCategory() { $this->cancelEdit(); $this->editingCategory = 'new'; } public function editCategory($id) { $category = Category::findOrFail($id); $this->editingCategory = $category->id; $this->name = $category->name; $this->slug = $category->slug; $this->description = $category->description; } public function saveCategory() { $this->validate([ 'name' => 'required|string|max:255', 'slug' => 'required|string|max:255|unique:categories,slug,' . ($this->editingCategory === 'new' ? 'NULL' : $this->editingCategory), 'description' => 'nullable|string', ]); if ($this->editingCategory && $this->editingCategory !== 'new') { $category = Category::find($this->editingCategory); $category->update([ 'name' => $this->name, 'slug' => Str::slug($this->slug), 'description' => $this->description, ]); session()->flash('message', 'Category updated successfully.'); } else { Category::create([ 'name' => $this->name, 'slug' => Str::slug($this->slug), 'description' => $this->description, ]); session()->flash('message', 'Category created successfully.'); } $this->cancelEdit(); } public function deleteCategory($id) { $category = Category::find($id); if ($category && $category->posts()->count() === 0) { $category->delete(); session()->flash('message', 'Category deleted successfully.'); } else { session()->flash('error', 'Cannot delete category with associated posts.'); } } public function cancelEdit() { $this->reset(['editingCategory', 'name', 'slug', 'description']); }
}
