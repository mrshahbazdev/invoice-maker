# 請求エンジン: 完全ガイド

このプラットフォームの中核となるロジックは、専門的な請求を完全にシームレスに生成できるように設計された、高度な自動化された請求エンジンを中心に展開しています。このガイドでは、請求書生成フロー内で使用できる完全な機能セットについて説明します。

---

## 1. 新しい請求書の作成
請求書の作成は簡単です。 **請求書** モジュールに移動し、**新しい請求書の作成** をクリックします。 
これにより、対話型のドラッグ アンド ドロップ ドキュメント ビルダーが起動します。

### 請求書のメタデータ
ラインアイテムを追加する前に、ドキュメントを定義するコアメタデータを設定します。
- **請求書番号:** デフォルトでは、システムにより請求書番号が自動的に増加します (例: INV-0001 が INV-0002 になります)。ただし、カスタム形式を使用する場合は、グローバル設定でプレフィックスと番号付けスキームを手動でオーバーライドできます。
- **発行日:** ドキュメントが正式に生成された日付。デフォルトは今日です。
- **期日/支払い条件:** お金を受け取る予定の時期を定義します。正確な日付を選択することも、「正味 15」、「正味 30」、「受領時期限」などの動的な用語を使用することもできます。システムは発行日に基づいて正確な期日を自動的に計算します。
- **クライアントの選択:** CRM から既存のクライアントを選択するか、ビルダーを終了せずに新しいクライアントをインラインですばやく定義します。

---

## 2. ラインアイテムの管理
品目セクションでは、実際の請求書を作成します。 

### 製品とサービスの追加
ラインアイテムは 2 つの異なる方法で追加できます。
1. **手動入力:** 完全にカスタムの説明、任意の価格、特定の数量を空の行に直接入力します。これは、カスタム プロジェクトの作業や独自のサービス料金に最適です。
2. **在庫から:** [製品の追加] ドロップダウンをクリックして、製品/サービス カタログから事前に保存されたアイテムを選択します。システムは、その品目の事前定義された説明、単価、デフォルトの税率を即座に挿入するため、時間を大幅に節約できます。

### リアルタイムの数学と税金
テーブル全体が数学的に統合されています。
- 数量や単価を調整すると、行の合計が即座に更新されます。
- **品目税:** 単一の品目に複数の税率 (地域 VAT や第 2 売上税など) を割り当てることができます。システムはこれらの税金を行ごとに動的かつ個別に計算します。
- **ドラッグ アンド ドロップによる並べ替え:** 任意の行の左側にあるハンドルをつかんで、最終的な PDF 上で項目がどのように表示されるかを並べ替えます。計算は順序に関係なく完全に計算され続けます。

---

## 3. 割引とグローバル修飾子
場合によっては、個々の項目を超えて総計を調整する必要があります。

- **グローバル割引:** 請求書ビルダーの下部で、グローバル割引を挿入できます。この割引が文字通りの固定金額 (例: 「$50 オフ」) か、小計の割合 (例: 「10% オフ」) であるかを選択できます。総計は、節約額を反映して動的に更新されます。
- **メモと条件:** クライアントへのパーソナライズされたメッセージ (「お取引ありがとうございます!」など) を追加し、厳格な法的条件 (「支払い遅延には 5% のペナルティが発生する」など) を定義します。

---

## 4. 発送と配達
請求書が完成したら、支払いを受け取ります。

### 自動メール送信
[請求書の送信] をクリックすると、電子メール ランチャーが開きます。
- システムは、クライアントに割り当てられたプライマリ電子メール アドレスを自動的に読み込みます。
- 電子メールの件名行と HTML 本文を大幅にカスタマイズできます。 CRM でこのクライアントに特定のテンプレートを定義している場合、それは事前にロードされます。
- このプラットフォームは、高度に圧縮され、美しく生成されたドキュメントの PDF を送信電子メールに直接添付します。

### クライアントポータル「Magic Link」
重要なのは、電子メールには「マジック リンク」も含まれていることです。クライアントがこのリンクをクリックすると、安全でパスワードのないクライアント ポータルに直接移動し、そこで請求書を動的に表示できます。

### ステータス追跡
請求書が送信されると、システムは自動的にステータスの追跡を開始します。
- クライアントが電子メールを開いてドキュメントをオンラインで表示したときを正確に確認できます (ステータスが送信済みから閲覧済みに変わります)。
- 期限を過ぎると、システムは請求書に真っ赤な **期限超過** バッジを付けます。
- 支払いが (手動または Stripe 経由で) 記録されると、残高が更新されます。一部支払われた場合は「一部」に移行します。完全に決済された場合は、「有料」としてアーカイブされます。